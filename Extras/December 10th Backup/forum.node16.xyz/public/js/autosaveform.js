function autosaveform(e){if(!autosaveform.domstorage||!window.JSON)return;var t=jQuery;var n={includefields:["text","textarea","checkbox","radio","select"],savingmsg:"Saving...",pause:1e3,onsave:function(e){}};var e=t.extend({},n,e);this.setting=e;this.onsave=e.onsave;var r=e.includefields.join(" ");e.includefields=t.map(e.includefields,function(e){return e=="select"||e=="textarea"?e:"input[type='"+e+"']"});var i=this;jQuery(function(t){var n=t("form#"+e.formid).css({position:"relative"});i.f=n.get(0);var s=t(i.f.elements).filter(e.includefields.join(",")).get();i.targetfields=s;i.loadfields();var o="keydown cut paste"+(/(checkbox)|(radio)|(select)/i.test(r)?" change":"");n.bind(o,function(e){var t=e.target.type.replace(/-\w+/i,"")||e.target.tagName;if(r.indexOf(t.toLowerCase())!=-1)i.activatesave()});n.submit(function(){i.savefields("clear")});if(e.savingmsg)i.$statusdiv=t('<div class="savestatus" style="visibility:hidden">'+e.savingmsg+"</div>").prependTo(n)})}autosaveform.prototype={getel:function(e){return document.getElementById(e)||this.f.elements[e]},getelname:function(e){return e.id||e.name},activatesave:function(){var e=this;clearTimeout(this.savetimer);this.savetimer=setTimeout(function(){e.savefields()},this.setting.pause)},savefields:function(e){var t={};var n=[];if(e!="clear"){for(var r=0,i=this.targetfields,s=i.length;r<s;r++){var o=this.getelname(i[r]);if(o){if(/text/i.test(i[r].type)&&i[r].value!=""){t[o]=i[r].value}else if(/(checkbox)|(radio)/i.test(i[r].type)){if(jQuery.inArray(o,n)==-1){for(var u=0,a=this.f.elements[o],f=a.length;u<f;u++){if(a[u].checked){t[o]=typeof t[o]=="undefined"?[u]:t[o].concat([u])}}n.push(i[r].name)}}else if(i[r].type.indexOf("select")!=-1){for(var l=0,c=i[r].options,h=c.length;l<h;l++){if(c[l].selected)t[o]=typeof t[o]=="undefined"?[l]:t[o].concat([l])}}}}if(this.$statusdiv)this.$statusdiv.css({opacity:0,visibility:"visible"}).animate({opacity:1},200).delay(400).animate({opacity:0},200);try{this.onsave(this.f,t)}catch(p){throw new Error("An error has occured inside your onsave() function:\n"+p.message)}}autosaveform._storage(this.f,"save",JSON.stringify(t))},loadfields:function(){try{var e=JSON.parse(autosaveform._storage(this.f,"load"))}catch(t){var e={}}for(var n in e){if(e.hasOwnProperty(n)){var r=this.getel(n);if(r){if(/(text)/.test(r.type)&&typeof e[n]=="string"){r.value=e[n]}else if(typeof e[n]=="object"&&r.type==undefined&&/(checkbox)|(radio)/i.test(r[0].type)){for(var i=0,s=this.f.elements[n],o=e[n].length;i<o;i++){var u=e[n][i];if(s[u]){s[u].checked=true}}}else if(/select/i.test(r.type)){for(var a=0,f=r.options,l=e[n].length;a<l;a++){var c=e[n][a];f[c].selected=true}}}}}}};autosaveform.domstorage=window.localStorage||(window.globalStorage?globalStorage[location.hostname]:null);autosaveform.cookieprefix=location.href.replace(new RegExp("("+location.host+"/)|("+location.protocol+"//)","g"),"");autosaveform._storage=function(e,t,n){var r=autosaveform.domstorage;if(t=="load"){return r[this.cookieprefix+"_"+e.id]}else if(t=="save"){r[this.cookieprefix+"_"+e.id]=n}}